<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Download</title>
    <script src="lib/jquery/jquery-2.0.2.js"></script>
    <script src="src/download.js"></script>
    <script src="src/dataProviders.js"></script>
    <!-- jQuery, Bootstrap -->
    <script src="lib/jquery/jquery-2.0.2.js"></script>
    <link href="lib/bootstrap/css/bootstrap.css" rel="stylesheet">
    <script src="lib/bootstrap/js/bootstrap.js"></script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
        function downloadButton(source, options) {
            console.log("source: " + source);
            console.log("options: " + JSON.stringify(options));
            getStations(source, options);
        }

        $(function(){
            //This complicated system works!
            function composeButton(source, options) {
                if (options === undefined || options === null) options = {};
                var type = options.type || 'CSV';
                var opts = JSON.stringify(options);
                return "<button id='" + type + source + "' type='button' class='btn btn-xs btn-primary' onclick='downloadButton(\"" + source + "\", " +  opts + ")'>download " + type + "</button>";
            }


            $(".pegel").click(function () {
                var params = $(this).attr("params");
                params = JSON.parse(params);
                console.log("params parsed:");
                console.log(params);
                var source = params.source;
                var options = params.options;
                //Request data
                //getStations("PEGELONLINE");
                //disable the button now.
                $(this).prop('disabled', true);
                //add two new download buttons: json and csv
                options.type = "CSV";
                $(this).after(composeButton(source, options));
                options.type = "JSON";
                $(this).after(composeButton(source, options));
            });
            
        });
    </script>
</head>
<body>
<h1>Stream Gage Data Providers</h1>
<p>
    This is a list of the data providers used by HydroCloud. Click on the links below to query each
    provider for a downloadable list of available stream gage sites.
</p>
<p>
    <strong>We are always looking for more data providers!</strong> If you know of a data service that provides access
    to stream discharge measurements, let us know by
    <a href="https://github.com/mroberge/HydroCloud/issues">filing an issue on GitHub</a> and
    <a href="https://github.com/mroberge/HydroCloud/wiki/Adding-More-Data-Providers">adding it to our system</a>!
</p>
<h3>Data Providers:</h3>
<ul>
    <li>USGS Daily (USA):
        <!-- Split button -->
        <div class="btn-group">
            <button type="button" class="btn btn-xs btn-primary">Request Stations for </button>
            <button type="button" class="btn btn-xs btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                State<span class="caret"></span>
                <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
                <li><a href="#" onclick='downloadButton("USGS-DV", {"state": "AL"});'>Alabama</a></li>
                <li><a href="#" onclick='downloadButton("USGS-DV", {"state": "GA"});'>Georgia</a></li>
                <li><a href="#" onclick='downloadButton("USGS-DV", {"state": "MD"});'>Maryland</a></li>
            </ul>
        </div>
    </li>
    <li>PEGEL-ONLINE (Germany):
        <button type="button" class="pegel btn btn-xs btn-primary" params='{"source": "PEGELONLINE", "options": {}}'>Download CSV of stations</button>
    </li>
</ul>



</body>
</html>